df[, ":="(bcollar_lag = as.numeric(bcollar_lag),
wcollar_lag = as.numeric(wcollar_lag),
teacher_lag = as.numeric(teacher_lag),
manager_lag = as.numeric(manager_lag),
municipal_lag = as.numeric(municipal_lag),
working_lag = as.numeric(working_lag))]
df[is.na(natjur_lag), "natjur_lag"] <- 0
df <- df[win_margin < 0.05 & win_margin > -0.05, ]
df <- df[incumbent == 0, ]
df <- df[, ":="(term2009 = as.numeric(term == 2009), term2013 = as.numeric(term == 2013),
term2017 = as.numeric(term == 2017), governo_lag = ifelse(floor(natjur_lag / 1000) == 1, 1, 0),
ong = ifelse(floor(natjur_lag / 1000) == 3, 1, 0), educ_1 = as.numeric(educ == 1),
educ_3 = as.numeric(educ == 3))]
df <- df[, newly_affiliated := as.numeric(years_affiliated == 1)]
df <- df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, winner, municipal, working_lag,
pub_bcollar, lnwage_dez, pub_wcollar, pub_manager, natjur_lag, educ, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
PARTY, MUNICIPIO
)]
df <- na.omit(df)
summary(df$age)
df[, ":="(age = (age - mean(age))/sd(age))]
summary(df$age)
df <- data.table(feather::read_feather(
file.path(DATA_PATH, "df_forest.feather")
))
df <- df[(age >= 18 & age <= 65), ]
df[years_affiliated >= 20, "years_affiliated"] <- 20
df <- df[, state := as.factor(floor(MUNICIPIO / 10000))]
df <- df[, PARTY := ifelse(PARTY %in% c(
"DC", "PCB", "PATRI", "PHS", "PMB", "PMN", "PODE", "PPL", "PRB", "PROS", "PRP",
"PRTB", "PSL", "PSOL", "PTC", "REDE", "SOLIDARIEDADE"
), "OUTROS", PARTY)]
df[, ":="(lnwage_dez_pman = pub_manager * lnwage_dez, lnwage_dez_pbc = pub_bcollar * lnwage_dez), ]
df[, ":="(bc_mun_lag = bcollar_lag * municipal_lag, bc_priv_lag = bcollar_lag * (1 - municipal_lag),
wc_mun_lag = wcollar_lag * municipal_lag, wc_priv_lag = wcollar_lag * (1 - municipal_lag),
man_mun_lag = manager_lag * municipal_lag, man_priv_lag = manager_lag * (1 - municipal_lag),
private_lag = working_lag * (1 - municipal_lag),
teach_mun_lag = teacher_lag * municipal_lag, teach_priv_lag = teacher_lag * (1 - municipal_lag))]
df[, ":="(bcollar_lag = as.numeric(bcollar_lag),
wcollar_lag = as.numeric(wcollar_lag),
teacher_lag = as.numeric(teacher_lag),
manager_lag = as.numeric(manager_lag),
municipal_lag = as.numeric(municipal_lag),
working_lag = as.numeric(working_lag))]
df[is.na(natjur_lag), "natjur_lag"] <- 0
df <- df[win_margin < 0.05 & win_margin > -0.05, ]
df <- df[incumbent == 0, ]
df <- df[, ":="(term2009 = as.numeric(term == 2009), term2013 = as.numeric(term == 2013),
term2017 = as.numeric(term == 2017), governo_lag = ifelse(floor(natjur_lag / 1000) == 1, 1, 0),
ong = ifelse(floor(natjur_lag / 1000) == 3, 1, 0), educ_1 = as.numeric(educ == 1),
educ_3 = as.numeric(educ == 3))]
df <- df[, newly_affiliated := as.numeric(years_affiliated == 1)]
df <- df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, winner, municipal, working_lag,
pub_bcollar, lnwage_dez, pub_wcollar, pub_manager, natjur_lag, educ, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
PARTY, MUNICIPIO
)]
df <- na.omit(df)
df[, ":="(age = (age - mean(age))/2*sd(age))]
summary(df$age)
df <- data.table(feather::read_feather(
file.path(DATA_PATH, "df_forest.feather")
))
df <- df[(age >= 18 & age <= 65), ]
df[years_affiliated >= 20, "years_affiliated"] <- 20
df <- df[, state := as.factor(floor(MUNICIPIO / 10000))]
df <- df[, PARTY := ifelse(PARTY %in% c(
"DC", "PCB", "PATRI", "PHS", "PMB", "PMN", "PODE", "PPL", "PRB", "PROS", "PRP",
"PRTB", "PSL", "PSOL", "PTC", "REDE", "SOLIDARIEDADE"
), "OUTROS", PARTY)]
df[, ":="(lnwage_dez_pman = pub_manager * lnwage_dez, lnwage_dez_pbc = pub_bcollar * lnwage_dez), ]
df[, ":="(bc_mun_lag = bcollar_lag * municipal_lag, bc_priv_lag = bcollar_lag * (1 - municipal_lag),
wc_mun_lag = wcollar_lag * municipal_lag, wc_priv_lag = wcollar_lag * (1 - municipal_lag),
man_mun_lag = manager_lag * municipal_lag, man_priv_lag = manager_lag * (1 - municipal_lag),
private_lag = working_lag * (1 - municipal_lag),
teach_mun_lag = teacher_lag * municipal_lag, teach_priv_lag = teacher_lag * (1 - municipal_lag))]
df[, ":="(bcollar_lag = as.numeric(bcollar_lag),
wcollar_lag = as.numeric(wcollar_lag),
teacher_lag = as.numeric(teacher_lag),
manager_lag = as.numeric(manager_lag),
municipal_lag = as.numeric(municipal_lag),
working_lag = as.numeric(working_lag))]
df[is.na(natjur_lag), "natjur_lag"] <- 0
df <- df[win_margin < 0.05 & win_margin > -0.05, ]
df <- df[incumbent == 0, ]
df <- df[, ":="(term2009 = as.numeric(term == 2009), term2013 = as.numeric(term == 2013),
term2017 = as.numeric(term == 2017), governo_lag = ifelse(floor(natjur_lag / 1000) == 1, 1, 0),
ong = ifelse(floor(natjur_lag / 1000) == 3, 1, 0), educ_1 = as.numeric(educ == 1),
educ_3 = as.numeric(educ == 3))]
df <- df[, newly_affiliated := as.numeric(years_affiliated == 1)]
df <- df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, winner, municipal, working_lag,
pub_bcollar, lnwage_dez, pub_wcollar, pub_manager, natjur_lag, educ, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
PARTY, MUNICIPIO
)]
df <- na.omit(df)
df[, ":="(age = (age - mean(age))/(2*sd(age)))]
summary(df$age)
df[, ":="(age = (age - mean(age))/(2*sd(age)), ability = (ability - mean(ability))/(2*sd(ability)))]
summary(ability)
summary(df$ability)
df[, ":="(age = (age - mean(age))/(2*sd(age)),
ability = (ability - mean(ability))/(2*sd(ability)),
tenure_lag = (tenure_lag - mean(tenure_lag))/(2*sd(tenure_lag)),
estab_size_lag = (estab_size_lag - mean(estab_size_lag))/(2*sd(estab_size_lag)),
years_affiliated = (years_affiliated - mean(years_affiliated))/(2*sd(years_affiliated))
)]
summary(df$years_affiliated)
summary(df$estab_size_lag)
summary(df$tenure_lag)
df <- data.table(feather::read_feather(
file.path(DATA_PATH, "df_forest.feather")
))
df <- df[(age >= 18 & age <= 65), ]
df[years_affiliated >= 20, "years_affiliated"] <- 20
df <- df[, state := as.factor(floor(MUNICIPIO / 10000))]
df <- df[, PARTY := ifelse(PARTY %in% c(
"DC", "PCB", "PATRI", "PHS", "PMB", "PMN", "PODE", "PPL", "PRB", "PROS", "PRP",
"PRTB", "PSL", "PSOL", "PTC", "REDE", "SOLIDARIEDADE"
), "OUTROS", PARTY)]
df[, ":="(lnwage_dez_pman = pub_manager * lnwage_dez, lnwage_dez_pbc = pub_bcollar * lnwage_dez), ]
df[, ":="(bc_mun_lag = bcollar_lag * municipal_lag, bc_priv_lag = bcollar_lag * (1 - municipal_lag),
wc_mun_lag = wcollar_lag * municipal_lag, wc_priv_lag = wcollar_lag * (1 - municipal_lag),
man_mun_lag = manager_lag * municipal_lag, man_priv_lag = manager_lag * (1 - municipal_lag),
private_lag = working_lag * (1 - municipal_lag),
teach_mun_lag = teacher_lag * municipal_lag, teach_priv_lag = teacher_lag * (1 - municipal_lag))]
df[, ":="(bcollar_lag = as.numeric(bcollar_lag),
wcollar_lag = as.numeric(wcollar_lag),
teacher_lag = as.numeric(teacher_lag),
manager_lag = as.numeric(manager_lag),
municipal_lag = as.numeric(municipal_lag),
working_lag = as.numeric(working_lag))]
df[is.na(natjur_lag), "natjur_lag"] <- 0
df <- df[win_margin < 0.05 & win_margin > -0.05, ]
df <- df[incumbent == 0, ]
df <- df[, ":="(term2009 = as.numeric(term == 2009), term2013 = as.numeric(term == 2013),
term2017 = as.numeric(term == 2017), governo_lag = ifelse(floor(natjur_lag / 1000) == 1, 1, 0),
ong = ifelse(floor(natjur_lag / 1000) == 3, 1, 0), educ_1 = as.numeric(educ == 1),
educ_3 = as.numeric(educ == 3))]
df <- df[, newly_affiliated := as.numeric(years_affiliated == 1)]
df <- df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, winner, municipal, working_lag,
pub_bcollar, lnwage_dez, pub_wcollar, pub_manager, natjur_lag, educ, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
PARTY, MUNICIPIO
)]
df <- na.omit(df)
df[, ":="(age = (age - mean(age))/(sd(age)),
ability = (ability - mean(ability))/(sd(ability)),
tenure_lag = (tenure_lag - mean(tenure_lag))/(sd(tenure_lag)),
estab_size_lag = (estab_size_lag - mean(estab_size_lag))/(sd(estab_size_lag)),
years_affiliated = (years_affiliated - mean(years_affiliated))/(sd(years_affiliated))
)]
summary(df$tenure_lag)
summary(df$estab_size_lag)
summary(df$years_affiliated)
summary(df$ability)
summary(df$age)
df <- data.table(feather::read_feather(
file.path(DATA_PATH, "df_forest.feather")
))
df <- df[(age >= 18 & age <= 65), ]
df[years_affiliated >= 20, "years_affiliated"] <- 20
df <- df[, state := as.factor(floor(MUNICIPIO / 10000))]
df <- df[, PARTY := ifelse(PARTY %in% c(
"DC", "PCB", "PATRI", "PHS", "PMB", "PMN", "PODE", "PPL", "PRB", "PROS", "PRP",
"PRTB", "PSL", "PSOL", "PTC", "REDE", "SOLIDARIEDADE"
), "OUTROS", PARTY)]
df[, ":="(lnwage_dez_pman = pub_manager * lnwage_dez, lnwage_dez_pbc = pub_bcollar * lnwage_dez), ]
df[, ":="(bc_mun_lag = bcollar_lag * municipal_lag, bc_priv_lag = bcollar_lag * (1 - municipal_lag),
wc_mun_lag = wcollar_lag * municipal_lag, wc_priv_lag = wcollar_lag * (1 - municipal_lag),
man_mun_lag = manager_lag * municipal_lag, man_priv_lag = manager_lag * (1 - municipal_lag),
private_lag = working_lag * (1 - municipal_lag),
teach_mun_lag = teacher_lag * municipal_lag, teach_priv_lag = teacher_lag * (1 - municipal_lag))]
df[, ":="(bcollar_lag = as.numeric(bcollar_lag),
wcollar_lag = as.numeric(wcollar_lag),
teacher_lag = as.numeric(teacher_lag),
manager_lag = as.numeric(manager_lag),
municipal_lag = as.numeric(municipal_lag),
working_lag = as.numeric(working_lag))]
df[is.na(natjur_lag), "natjur_lag"] <- 0
df <- df[win_margin < 0.05 & win_margin > -0.05, ]
df <- df[incumbent == 0, ]
df <- df[, ":="(term2009 = as.numeric(term == 2009), term2013 = as.numeric(term == 2013),
term2017 = as.numeric(term == 2017), governo_lag = ifelse(floor(natjur_lag / 1000) == 1, 1, 0),
ong = ifelse(floor(natjur_lag / 1000) == 3, 1, 0), educ_1 = as.numeric(educ == 1),
educ_3 = as.numeric(educ == 3))]
df <- df[, newly_affiliated := as.numeric(years_affiliated == 1)]
df <- df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, winner, municipal, working_lag,
pub_bcollar, lnwage_dez, pub_wcollar, pub_manager, natjur_lag, educ, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
PARTY, MUNICIPIO
)]
df <- na.omit(df)
summary(df$educ_1)
0.4196*(1-0.4196)
summary(scale(df$educ_1))
0.017/0.24
summary(df$educ_3)
0.1918*(1-0.1918)
0.1918*(1-0.1918)*0.01
0.01/0.1918*(1-0.1918)
# install.packages("Rcpp", "data.table", "feather", "grf", "fixest", "margins")
library(Rcpp)
library(data.table)
library(feather)
library(arrow)
library(grf)
library(fixest)
library(margins)
#library(devtools); devtools::install_github("grf-labs/sufrep")
library(sufrep)
# remotes::install_github('susanathey/causalTree')
library(causalTree)
library(ggplot2)
library(ggthemes)
library(tree)
library(stargazer)
DATA_PATH_WIN <- "G:/My Drive/research/patronage/data"
DATA_PATH <- "/hd/home/Google Drive/research/patronage/data"
df <- data.table(feather::read_feather(
file.path(DATA_PATH, "df_forest.feather")
))
df <- df[(age >= 18 & age <= 65), ]
df[years_affiliated >= 20, "years_affiliated"] <- 20
df <- df[, state := as.factor(floor(MUNICIPIO / 10000))]
df <- df[, PARTY := ifelse(PARTY %in% c(
"DC", "PCB", "PATRI", "PHS", "PMB", "PMN", "PODE", "PPL", "PRB", "PROS", "PRP",
"PRTB", "PSL", "PSOL", "PTC", "REDE", "SOLIDARIEDADE"
), "OUTROS", PARTY)]
df[, ":="(lnwage_dez_pman = pub_manager * lnwage_dez, lnwage_dez_pbc = pub_bcollar * lnwage_dez), ]
df[, ":="(bc_mun_lag = bcollar_lag * municipal_lag, bc_priv_lag = bcollar_lag * (1 - municipal_lag),
wc_mun_lag = wcollar_lag * municipal_lag, wc_priv_lag = wcollar_lag * (1 - municipal_lag),
man_mun_lag = manager_lag * municipal_lag, man_priv_lag = manager_lag * (1 - municipal_lag),
private_lag = working_lag * (1 - municipal_lag),
teach_mun_lag = teacher_lag * municipal_lag, teach_priv_lag = teacher_lag * (1 - municipal_lag))]
df[, ":="(bcollar_lag = as.numeric(bcollar_lag),
wcollar_lag = as.numeric(wcollar_lag),
teacher_lag = as.numeric(teacher_lag),
manager_lag = as.numeric(manager_lag),
municipal_lag = as.numeric(municipal_lag),
working_lag = as.numeric(working_lag))]
df[is.na(natjur_lag), "natjur_lag"] <- 0
df <- df[win_margin < 0.05 & win_margin > -0.05, ]
df <- df[incumbent == 0, ]
df <- df[, ":="(term2009 = as.numeric(term == 2009), term2013 = as.numeric(term == 2013),
term2017 = as.numeric(term == 2017), governo_lag = ifelse(floor(natjur_lag / 1000) == 1, 1, 0),
ong = ifelse(floor(natjur_lag / 1000) == 3, 1, 0), educ_1 = as.numeric(educ == 1),
educ_3 = as.numeric(educ == 3))]
df <- df[, newly_affiliated := as.numeric(years_affiliated == 1)]
df <- df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, winner, municipal, working_lag,
pub_bcollar, lnwage_dez, pub_wcollar, pub_manager, natjur_lag, educ, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
PARTY, MUNICIPIO
)]
df <- na.omit(df)
df <- df[MUNICIPIO %in% df_mun[0:150]]
df_mun <- unique(df$MUNICIPIO)
df <- df[MUNICIPIO %in% df_mun[0:150]]
X <- model.matrix(~ 0 + ., df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, working_lag, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
relevel(as.factor(PARTY), ref = "OUTROS")
)])
X <- scale(X)
pdf(file = file.path(DATA_PATH, "corrplot_full.pdf"))
corrplot::corrplot(cor(X), method = 'number', type = 'lower')
dev.off()
encoder <- sufrep::make_encoder(X, as.factor(df$MUNICIPIO), method = "means")
X2 <- encoder(X, as.factor(df$MUNICIPIO))
## -------------------------------------------
## CAUSAL FOREST------------------------------
## -------------------------------------------
Wforest <- boosted_regression_forest(X2, df$winner,
clusters = df$MUNICIPIO,
tune.parameters = "all", num.threads = ncores, seed = 5663260
)
df <- df[, What := predict(Wforest)$predictions]
rm(Wforest)
gc()
pdf(file = file.path(DATA_PATH, "propensity_score_full.pdf"))
ggplot(df, aes(x = df$What)) +
geom_histogram(aes(y = ..density..), binwidth = 0.01) +
theme_stata(base_size = 18) +
xlab("Propensity score") +
ylab("Density")
dev.off()
## -------------------------------------------
## Y: municipal employment
## -------------------------------------------
Yforest <- boosted_regression_forest(X2, df$municipal,
clusters = df$MUNICIPIO,
tune.parameters = "all", num.threads = ncores, seed = 5663260
)
df <- df[, Yhat := predict(Yforest)$predictions]
rm(Yforest)
gc()
tau_forest <- causal_forest(X2, df$municipal, df$winner,
Y.hat = df$Yhat, W.hat = df$What,
clusters = df$MUNICIPIO,
tune.parameters = "all", num.threads = ncores, seed = 5663260
)
df <- df[, tau_hat := predict(tau_forest)$predictions]
ate_1 <- average_treatment_effect(tau_forest, target.sample = "all"); ate_1
average_treatment_effect(tau_forest, target.sample = "treated")
average_treatment_effect(tau_forest, target.sample = "control")
pdf(file = file.path(DATA_PATH, "histogram_y1_full.pdf"))
ggplot(df, aes(x = tau_hat)) +
geom_histogram(aes(y = ..density..), binwidth = 0.01) +
theme_stata(base_size = 18) +
xlab("Predicted CATE (municipal employment)") +
ylab("Density") + geom_vline(xintercept = ate_1[1], color="#FDA172", size=1)
dev.off()
blp_y1 <- best_linear_projection(tau_forest, X2, vcov.type = "HC3"); blp_y1
options(scipen = 999)
ncores <- parallel::detectCores()
set.seed(5663260)
X <- model.matrix(~ 0 + ., df[, .(
age, educ_1, educ_3, SEXO, term2009, term2013, term2017,
bcollar_lag, manager_lag, governo_lag, working_lag, ability,
tenure_lag, estab_size_lag, years_affiliated, newly_affiliated,
relevel(as.factor(PARTY), ref = "OUTROS")
)])
X <- scale(X)
pdf(file = file.path(DATA_PATH, "corrplot_full.pdf"))
corrplot::corrplot(cor(X), method = 'number', type = 'lower')
dev.off()
encoder <- sufrep::make_encoder(X, as.factor(df$MUNICIPIO), method = "means")
X2 <- encoder(X, as.factor(df$MUNICIPIO))
## -------------------------------------------
## CAUSAL FOREST------------------------------
## -------------------------------------------
Wforest <- boosted_regression_forest(X2, df$winner,
clusters = df$MUNICIPIO,
tune.parameters = "all", num.threads = ncores, seed = 5663260
)
df <- df[, What := predict(Wforest)$predictions]
rm(Wforest)
gc()
pdf(file = file.path(DATA_PATH, "propensity_score_full.pdf"))
ggplot(df, aes(x = df$What)) +
geom_histogram(aes(y = ..density..), binwidth = 0.01) +
theme_stata(base_size = 18) +
xlab("Propensity score") +
ylab("Density")
dev.off()
## -------------------------------------------
## Y: municipal employment
## -------------------------------------------
Yforest <- boosted_regression_forest(X2, df$municipal,
clusters = df$MUNICIPIO,
tune.parameters = "all", num.threads = ncores, seed = 5663260
)
df <- df[, Yhat := predict(Yforest)$predictions]
rm(Yforest)
gc()
tau_forest <- causal_forest(X2, df$municipal, df$winner,
Y.hat = df$Yhat, W.hat = df$What,
clusters = df$MUNICIPIO,
tune.parameters = "all", num.threads = ncores, seed = 5663260
)
df <- df[, tau_hat := predict(tau_forest)$predictions]
ate_1 <- average_treatment_effect(tau_forest, target.sample = "all"); ate_1
average_treatment_effect(tau_forest, target.sample = "treated")
average_treatment_effect(tau_forest, target.sample = "control")
pdf(file = file.path(DATA_PATH, "histogram_y1_full.pdf"))
ggplot(df, aes(x = tau_hat)) +
geom_histogram(aes(y = ..density..), binwidth = 0.01) +
theme_stata(base_size = 18) +
xlab("Predicted CATE (municipal employment)") +
ylab("Density") + geom_vline(xintercept = ate_1[1], color="#FDA172", size=1)
dev.off()
blp_y1 <- best_linear_projection(tau_forest, X2, vcov.type = "HC3"); blp_y1
blp_y1$
coefficients
blp_y1[1]
blp_y1[2] * mean(df$age) * (1 - mean(df$age))
mean(df$age)
# Here I transform back the coefficients of binary variables
# to interpretable 0-1 form
blp_y1[3] <- blp_y1[3] * mean(df$educ_1) * (1 - mean(df$educ_1))
blp_y1[3]
View(X)
mean(X$educ_1)
mean(X[, 3])
sd(X[, 2])
mean(X[, 2])
mean(df$educ_1)
sd(df$educ_1)
summary(df$educ_1)
summary(X[, 2])
blp_y1 <- best_linear_projection(tau_forest, X2, vcov.type = "HC3"); blp_y1
# Here I transform back the coefficients of binary variables
# to interpretable 0-1 form
blp_y1[3] <- blp_y1[3] / (mean(df$educ_1) * (1 - mean(df$educ_1)))
blp_y1
blp_y1[2, 2]
blp_y1[3, 2] <- blp_y1[3, 2] / (mean(df$educ_1) * (1 - mean(df$educ_1)))
blp_y1
blp_y1[4, 1] <- blp_y1[4, 1] / (mean(df$educ_3) * (1 - mean(df$educ_3)))
blp_y1[4, 2] <- blp_y1[4, 2] / (mean(df$educ_3) * (1 - mean(df$educ_3)))
blp_y1[5, 1] <- blp_y1[5, 1] / (mean(df$SEXO) * (1 - mean(df$SEXO)))
blp_y1[5, 2] <- blp_y1[5, 2] / (mean(df$SEXO) * (1 - mean(df$SEXO)))
blp_y1
blp_y1[9, 1] <- blp_y1[5, 1] / (mean(df$bcollar_lag) * (1 - mean(df$bcollar_lag)))
blp_y1[9, 2] <- blp_y1[5, 2] / (mean(df$bcollar_lag) * (1 - mean(df$bcollar_lag)))
blp_y1[5, 1] <- blp_y1[5, 1] / (mean(df$SEXO) * (1 - mean(df$SEXO)))
blp_y1[5, 2] <- blp_y1[5, 2] / (mean(df$SEXO) * (1 - mean(df$SEXO)))
blp_y1[9, 1] <- blp_y1[9, 1] / (mean(df$bcollar_lag) * (1 - mean(df$bcollar_lag)))
blp_y1[9, 2] <- blp_y1[9, 2] / (mean(df$bcollar_lag) * (1 - mean(df$bcollar_lag)))
blp_y1[10, 1] <- blp_y1[10, 1] / (mean(df$manager_lag) * (1 - mean(df$manager_lag)))
blp_y1[10, 2] <- blp_y1[10, 2] / (mean(df$manager_lag) * (1 - mean(df$manager_lag)))
blp_y1[11, 1] <- blp_y1[11, 1] / (mean(df$governo_lag) * (1 - mean(df$governo_lag)))
blp_y1[11, 2] <- blp_y1[11, 2] / (mean(df$governo_lag) * (1 - mean(df$governo_lag)))
blp_y1[12, 1] <- blp_y1[12, 1] / (mean(df$working_lag) * (1 - mean(df$working_lag)))
blp_y1[12, 2] <- blp_y1[12, 2] / (mean(df$working_lag) * (1 - mean(df$working_lag)))
blp_y1[17, 1] <- blp_y1[17, 1] / (mean(df$newly_affiliated) * (1 - mean(df$newly_affiliated)))
blp_y1[17, 2] <- blp_y1[17, 2] / (mean(df$newly_affiliated) * (1 - mean(df$newly_affiliated)))
blp_y1
blp_y1 <- best_linear_projection(tau_forest, X2, vcov.type = "HC3"); blp_y1
blp_y1[3, 1] <- blp_y1[3, 1] / (mean(df$educ_1) * (1 - mean(df$educ_1)))
blp_y1[3, 2] <- blp_y1[3, 2] / (mean(df$educ_1) * (1 - mean(df$educ_1)))
blp_y1[4, 1] <- blp_y1[4, 1] / (mean(df$educ_3) * (1 - mean(df$educ_3)))
blp_y1[4, 2] <- blp_y1[4, 2] / (mean(df$educ_3) * (1 - mean(df$educ_3)))
blp_y1[5, 1] <- blp_y1[5, 1] / (mean(df$SEXO) * (1 - mean(df$SEXO)))
blp_y1[5, 2] <- blp_y1[5, 2] / (mean(df$SEXO) * (1 - mean(df$SEXO)))
blp_y1[9, 1] <- blp_y1[9, 1] / (mean(df$bcollar_lag) * (1 - mean(df$bcollar_lag)))
blp_y1[9, 2] <- blp_y1[9, 2] / (mean(df$bcollar_lag) * (1 - mean(df$bcollar_lag)))
blp_y1[10, 1] <- blp_y1[10, 1] / (mean(df$manager_lag) * (1 - mean(df$manager_lag)))
blp_y1[10, 2] <- blp_y1[10, 2] / (mean(df$manager_lag) * (1 - mean(df$manager_lag)))
blp_y1[11, 1] <- blp_y1[11, 1] / (mean(df$governo_lag) * (1 - mean(df$governo_lag)))
blp_y1[11, 2] <- blp_y1[11, 2] / (mean(df$governo_lag) * (1 - mean(df$governo_lag)))
blp_y1[12, 1] <- blp_y1[12, 1] / (mean(df$working_lag) * (1 - mean(df$working_lag)))
blp_y1[12, 2] <- blp_y1[12, 2] / (mean(df$working_lag) * (1 - mean(df$working_lag)))
blp_y1[17, 1] <- blp_y1[17, 1] / (mean(df$newly_affiliated) * (1 - mean(df$newly_affiliated)))
blp_y1[17, 2] <- blp_y1[17, 2] / (mean(df$newly_affiliated) * (1 - mean(df$newly_affiliated)))
blp_y1
library(haven)
brasil1985_limpo <- read_dta("/hd/home/Google Drive/research/_rais/NEREUS/brasil1985_limpo.dta")
View(brasil1985_limpo)
library(haven)
PATH <- "/hd/home/Google Drive/research/_rais/NEREUS/"
df <- haven::read_dta(file.path(PATH, "brasil1985_limpo.dta.tar.gz"), n_max=10000)
df <- haven::read_dta(file.path(PATH, "brasil1985_limpo.dta"), n_max=10000)
View(df)
View(df)
df <- haven::read_dta(file.path(PATH, "brasil2000_limpo.dta"), n_max=10000)
View(df)
df <- haven::read_dta(file.path(PATH, "centrooeste2008_limpo_nome.dta"), n_max=10000)
View(df)
library(haven)
PATH <- "/hd/home/Google Drive/research/_rais/NEREUS/"
df <- haven::read_dta(file.path(PATH, "centrooeste2008_limpo_nome.dta"), n_max=1000000)
getcwd()
getwd()
setwd("/hd/home/Google Drive/work/teaching/esp-u-20221/slides/")
install.packages("RefManageR")
install.packages("bibtex")
# install.packages("Rcpp", "data.table", "feather", "grf", "fixest", "margins")
library(Rcpp)
library(data.table)
library(feather)
library(arrow)
library(grf)
library(fixest)
library(margins)
#library(devtools); devtools::install_github("grf-labs/sufrep")
library(sufrep)
# remotes::install_github('susanathey/causalTree')
library(causalTree)
library(ggplot2)
library(ggthemes)
library(tree)
library(stargazer)
DATA_PATH <- "/hd/home/Google Drive/research/patronage/data"
df_ran <- data.table(feather::read_feather(
file.path(DATA_PATH, "df_ran_full.feather")
))
stargazer(df_ran)
rm(df_ran)
library(dplyr)
library(data.table)
library(haven)
library(rdrobust)
library(bunching)
library(fixest)
library(ggplot2)
library(ggthemes)
library(feather)
library(here)
options(scipen = 999)
PEDRO_PATH <- "/hd/home/Google Drive/research/iptu/"
FILE_PATH <- PEDRO_PATH
imoveis <- data.table(read_dta(here("data", "imoveis.dta")))
ggplot(data = imoveis, aes(x = ANO_LAN)) +
geom_histogram(binwidth = 1) +
theme_stata(base_size = 18) +
ylab("") +
xlab("Year")
